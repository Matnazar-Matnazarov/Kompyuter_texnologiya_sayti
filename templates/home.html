{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="min-h-screen bg-gradient-to-b from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800 py-8">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="space-y-8">
      <div class="flex justify-center">
        <select id="service-select" class="w-72 px-4 py-3 text-lg rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 shadow-lg transition-all duration-300 hover:border-blue-500" onchange="redirectToUrl()">
          <option selected>{{qidiruv}}</option>
          <option value="home">Barcha mahsulotlar</option>
          {% for i in turlar %}
            <option value="{{i.mahsulot_turi}}">{{i.mahsulot_turi}}</option>
          {% endfor %}
        </select>
      </div>

      <div class="flex flex-col lg:flex-row gap-8">
        <div class="flex-1 space-y-6">
          {% for i in mahsulotlar %}
          <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 overflow-hidden transform hover:-translate-y-1">
            <div class="flex">
              <div class="w-1/3">
                <img src="{{i.rasm.url}}" class="w-full h-48 object-cover hover:scale-105 transition-transform duration-300" alt="{{i.mahsulot_nomi}}">
              </div>
              <div class="w-2/3 p-6">
                <h5 class="text-xl font-semibold text-gray-900 dark:text-white mb-3">{{i.mahsulot_nomi}}</h5>
                {% if request.user.is_authenticated %}
                  <p class="text-lg text-gray-700 dark:text-gray-300" id="narx{{i.id}}">{{ i.mahsulot_narxi }} UZS</p>
                  <div class="mt-4">
                    <button class="btn_increase group inline-flex items-center px-6 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-medium rounded-lg transition-all duration-300 shadow-md hover:shadow-lg transform hover:-translate-y-0.5" data-product-id="{{ i.id }}">
                      <i class="bi bi-cart-plus mr-2"></i>
                      <span>Savatga qo'shish</span>
                    </button>
                  </div>
                {% else %}
                  <p class="text-lg text-gray-700 dark:text-gray-300 mt-2">{{ i.mahsulot_narxi }} UZS</p>
                {% endif %}
              </div>
            </div>
          </div>
          {% endfor %}
        </div>

        <div class="lg:w-80">
          {% if request.user.is_authenticated and summa %}
          <div class="space-y-4 sticky top-4">
            <div class="grid grid-cols-1 gap-4">
              {% for i in tanlangan %}
              <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden transform transition-all duration-300 hover:shadow-xl">
                <img src="{{i.mahsulot_id.rasmi.url}}" class="w-full h-32 object-cover hover:scale-105 transition-transform duration-300" alt="{{i.mahsulot_id.turi.mahsulot_turi}}">
                <div class="p-4">
                  <h6 class="font-medium text-gray-900 dark:text-white h-8">{{ i.mahsulot_id.turi.mahsulot_turi }}</h6>
                  <p class="text-gray-700 dark:text-gray-300 mt-1">{{i.mahsulot_id.narxi}} UZS</p>
                  <button class="btn_decrease w-full mt-3 inline-flex items-center justify-center px-4 py-2.5 bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700 text-white font-medium rounded-lg transition-all duration-300 shadow-md hover:shadow-lg transform hover:-translate-y-0.5" data-product-id="{{ i.mahsulot_id.id }}">
                    <i class="bi bi-trash3-fill mr-2"></i>
                    <span>O'chirish</span>
                  </button>
                </div>
              </div>
              {% endfor %}
            </div>
            <div class="bg-white dark:bg-gray-800 rounded-xl p-4 shadow-lg">
              <h3 class="text-xl font-semibold text-gray-900 dark:text-white">Jami summa: {{summa}} UZS</h3>
            </div>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function redirectToUrl() {
    var select = document.getElementById("service-select");
    var selectedOption = select.options[select.selectedIndex].value;
    if(selectedOption=="home"){
      window.location.href="{% url 'lobaratoriya1' %}";
    }
    else{
      window.location.href = "/home/" + selectedOption;
    }
  }

  $(document).ready(function() {
    $('.btn_increase').click(function(e) {
      e.preventDefault();
      var productId = $(this).data('product-id');
      updateQuantity(productId, 'increase');
    });

    $('.btn_decrease').click(function(e) {
      e.preventDefault(); 
      var productId = $(this).data('product-id');
      updateQuantity(productId, 'decrease');
    });

    function updateQuantity(productId, action) {
      $.ajax({
        type: 'GET',
        url: '/update_quantity/' + productId + '/' + action + '/',
        success: function(response) {
          window.location.reload();
        },
        error: function(xhr, status, error) {
          console.error(error);
        }
      });
    }
  });
</script>

{% endblock content %}
